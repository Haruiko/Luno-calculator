<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="description" content="Calculate crafting profits with materials cost, success rates, and daily focus optimization">
<title>Luno Profit Calculator</title>
<link rel="stylesheet" href="assets/css/styles.css">
<script src="assets/js/scripts.js" defer></script>
</head>
<body>
  <div class="wrap">

    <!-- Top header with Home -->
    <div class="topbar">
      <div>
        <h1>Luno Profit Calculator</h1>
        <div class="muted small">Edit materials, success chances, and prices. All results update instantly.</div>
      </div>
      <a class="home-btn" href="index.html"><span class="arrow">‚Üê</span> Home</a>
    </div>

    <!-- Product & Focus Config -->
    <div class="card">
      <div class="inputs-row">
        <div>
          <label>Product sale price (luno)</label>
          <input id="salePrice" type="number" min="0" step="0.01" value="2012">
        </div>

        <!-- Crafts per day override -->
        <div>
          <label>Crafts per day (override, optional)</label>
          <input id="craftsPerDayInput" type="number" min="0" step="1" placeholder="auto">
        </div>

        <div>
          <label>Focus per craft</label>
          <input id="focusPerCraft" type="number" min="1" step="1" value="10">
        </div>

        <div>
          <label>Daily focus available</label>
          <input id="dailyFocus" type="number" min="0" step="1" value="300">
        </div>

        <!-- NEW: Deposit fee -->
        <div>
          <label>Deposit fee (luno / day)</label>
          <input id="depositFee" type="number" min="0" step="0.01" value="0">
        </div>

        <div>
          <label>Optional: Market fee (%)</label>
          <input id="feePct" type="number" min="0" step="0.01" value="0">
        </div>
      </div>
    </div>

    <!-- Materials -->
    <div class="card" id="materialsCard">
      <div class="flex" style="justify-content:space-between; align-items:center;">
        <h2>Materials</h2>
        <div class="flex">
          <button id="addMaterial" aria-label="Add new material">‚ûï Add material</button>
          <button id="resetToDefaultMaterials" class="muted" aria-label="Reset to default materials">Reset to example</button>
          <button id="exportConfig" class="muted" aria-label="Export configuration">üì§ Export</button>
          <button id="importConfig" class="muted" aria-label="Import configuration">üì• Import</button>
        </div>
      </div>
      <table class="table" id="materialsTable">
        <thead>
          <tr>
            <th style="width:30%">Name</th>
            <th>Qty / craft</th>
            <th>Unit cost (luno)</th>
            <th class="right">Line cost</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="materialsBody"></tbody>
        <tfoot>
          <tr>
            <td colspan="3" class="right total">Total materials cost / craft</td>
            <td class="right total" id="materialsTotal">‚Äî</td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Success Chances -->
    <div class="card" id="probCard">
      <div class="flex" style="justify-content:space-between; align-items:center;">
        <h2>Success chances (outcome ‚Üí %)</h2>
        <div class="flex">
          <button id="addOutcome" aria-label="Add new outcome">‚ûï Add outcome</button>
          <button id="normalizeProb" class="muted hidden" aria-label="Normalize probabilities to 100%">Normalize to 100%</button>
          <span class="pill hidden" aria-live="polite">Sum: <span id="probSum">‚Äî</span>%</span>
        </div>
      </div>
      <table class="table" id="probTable">
        <thead>
          <tr>
            <th>Items produced</th>
            <th>Chance (%)</th>
            <th class="right">Contribution</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="probBody"></tbody>
        <tfoot>
          <tr>
            <td class="right total" colspan="2">Expected items / craft</td>
            <td class="right total" id="expectedItems">‚Äî</td>
            <td></td>
          </tr>
        </tfoot>
      </table>
      <div id="probWarning" class="warn small" style="display:none;">Warning: probabilities do not sum to 100%. Values will be used as-is.</div>
    </div>

    <!-- Results -->
    <div class="card">
      <h2>Results</h2>
      <div class="grid-2">
        <div class="card">
          <h3>Per Craft</h3>
          <div class="row">
            <div style="grid-column: span 8;">Revenue (after fee)</div>
            <div class="right" style="grid-column: span 4;"><span id="revPerCraft">‚Äî</span> luno</div>
          </div>
          <div class="row">
            <div style="grid-column: span 8;">Materials cost</div>
            <div class="right" style="grid-column: span 4;"><span id="matPerCraft">‚Äî</span> luno</div>
          </div>
          <hr class="hr">
          <div class="row total">
            <div style="grid-column: span 8;">Profit per craft</div>
            <div class="right" style="grid-column: span 4;"><span id="profitPerCraft">‚Äî</span> luno</div>
          </div>
          <div class="row">
            <div style="grid-column: span 8;">Profit per focus</div>
            <div class="right" style="grid-column: span 4;"><span id="profitPerFocus">‚Äî</span> luno/focus</div>
          </div>
          <div class="row">
            <div style="grid-column: span 8;">Break-even sale price</div>
            <div class="right" style="grid-column: span 4;"><span id="breakeven">‚Äî</span> luno</div>
          </div>
        </div>

        <!-- Per Day -->
        <div class="card">
          <h3>Per Day</h3>
          <div class="row">
            <div style="grid-column: span 8;">Crafts per day</div>
            <div class="right" style="grid-column: span 4;"><span id="craftsPerDay">‚Äî</span></div>
          </div>
          <div class="row">
            <div style="grid-column: span 8;">Materials needed</div>
            <div class="right" style="grid-column: span 4;"><span id="matsPerDay">‚Äî</span></div>
          </div>
          <div class="row">
            <div style="grid-column: span 8;">Revenue per day (after fee)</div>
            <div class="right" style="grid-column: span 4;"><span id="revPerDay">‚Äî</span> luno</div>
          </div>
          <div class="row">
            <div style="grid-column: span 8;">Materials cost per day</div>
            <div class="right" style="grid-column: span 4;"><span id="matPerDay">‚Äî</span> luno</div>
          </div>
          <div class="row">
            <div style="grid-column: span 8;">Items crafted per day (expected)</div>
            <div class="right" style="grid-column: span 4;"><span id="itemsPerDay">‚Äî</span></div>
          </div>
          <!-- NEW: show deposit fee impact -->
          <div class="row">
            <div style="grid-column: span 8;">Deposit fee (per day)</div>
            <div class="right" style="grid-column: span 4;"><span id="depositPerDay">‚Äî</span> luno</div>
          </div>

          <hr class="hr">
          <div class="row total">
            <div style="grid-column: span 8;">Profit per day</div>
            <div class="right" style="grid-column: span 4;"><span id="profitPerDay">‚Äî</span> luno</div>
          </div>
        </div>
      </div>
      <div class="footer" id="footerNote"></div>
    </div>
  </div>

  <!-- Loading overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
  </div>
</body>
</html>
